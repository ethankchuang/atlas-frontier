**AI-Powered MUD MVP Specification**

---

## üß± Summary

Create a multiplayer AI-driven MUD game that uses a fullscreen generated image as the backdrop and overlaid descriptive text + user input as the interface. The game world is procedurally generated by an LLM, images are rendered by AI image models, and all player actions are interpreted via freeform text. The game has a persistent world memory and tracks a main questline that anchors the dynamic story. Players can explore the world together or independently, with real-time presence in shared rooms. The entire world is persisted so that players can come and go, and while minor changes may occur daily (e.g., weather, crowd density, dynamic events), the core layout, key NPCs, and overall quest structures remain consistent.

---

## üöÄ MVP Goals

- Reactive, LLM-powered freeform text interface
- Consistent, persistent world memory
- Procedural story and room generation
- Real-time or streaming image rendering for each location
- Central questline with optional open-world side quests
- **Multiplayer with real-time presence and shared rooms**
- **AI-driven NPCs that are integral to the main story and world**
- **NPCs have their own LLM-powered memories and personalities**
- **Text and emoji-based player-to-player chat and emotes**
- **Persistent world and character memory across sessions**

---

## üí° Key Features

### 1. **Text-Based Gameplay with LLM**

- Accepts freeform user text input (e.g., "talk to the old man" or "go west")
- Responds with:

  - Updated description
  - Changes to inventory, location, NPCs, or quest state
  - Updates to nearby players if visible actions occur
  - Supports dialogue with **AI-powered NPCs with persistent memory**

### 2. **Scene Memory + World Persistence**

- Each scene ("room") is a node in a graph
- Each node stores:

  - Title, description
  - Connected directions (e.g., north: `room_id_xyz`)
  - Key items/NPCs
  - List of current players present
  - Image seed/hash

- System uses a vector DB (e.g., Chroma or Pinecone) + structured DB (e.g., Firestore or Redis)
- Persistent world graph saved and loaded per session
- Minor environment changes can be introduced periodically via system events

### 3. **Main Quest + Dynamic Plot**

- On game start, LLM initializes main story (stored in memory)
- Each LLM action step includes this prompt:

  - Current world state
  - Summary of the player‚Äôs progress
  - Reminder of main questline

- Each player has an independent quest state but can explore with others
- **NPCs are key to the plot, side quests, lore, and puzzle-solving**
- **NPCs retain history of interactions across sessions using vector memory embeddings and structured logs**

### 4. **AI-Generated Visuals**

- One fullscreen image per room
- Generated by **OpenAI GPT-4o Vision/Image model**
- Style: realistic, cinematic POV from player‚Äôs perspective
- May regenerate images from slightly different angles for variety or based on player movement

### 5. **Interface & UX**

- Fullscreen canvas or HTML image backdrop
- Text scroll box at bottom (overlaid on image)
- Text input box for user commands
- Streamed text responses to mimic real-time chat
- **Avatar icons overlaid in the top corner of the screen to show who is nearby**
- **Speaking indicators show which player is actively talking**
- **Text and emoji reactions/emotes supported between players**
- Ability to travel together or break off and explore independently

---

## üåê System Architecture

### Frontend

- **Next.js (React) + Tailwind CSS**
- Fullscreen layout with:

  - `<img>` or canvas for background
  - Text overlay box (div with scrolling)
  - Text input field (fixed bottom)
  - **Player avatars displayed in corner when in same room**
  - **Streamed chat-style text updates**
  - **Emoji/emote UI buttons for fast reactions**
  - **Player presence indicators + NPC dialogue highlighting**

- WebSocket for real-time multiplayer state updates

### Backend

- **FastAPI** or **Flask**, possibly backed by ASGI/UVicorn for concurrency
- Endpoints:

  - `POST /action`: handle user input, update state, return LLM output
  - `POST /generate_image`: request image generation (stream or poll)
  - `GET /room/:id`: fetch room data
  - `GET /start`: initialize world and main quest
  - `POST /presence`: update player presence in room
  - `POST /chat`: player-to-player chat or emotes
  - `POST /npc`: route NPC dialogue and update memory embeddings

- Uses:

  - **OpenAI GPT-4o API** (text + image generation)
  - **Firestore or Redis** (game state, world graph, inventory, room metadata)
  - **Chroma / Pinecone** (vector memory for NPC dialogue history and LLM recall)
  - Optional: **PostgreSQL** for structured data persistence across sessions

---

## üìä Data Models

### Room

```json
{
  "id": "room_id_xyz",
  "title": "Dark Cave Entrance",
  "description": "You stand at the mouth of a dark, dripping cave...",
  "image_url": "https://cdn/xyz.jpg",
  "connections": {
    "north": "room_id_abc",
    "east": "room_id_def"
  },
  "npcs": ["old_guardian"],
  "items": ["rusted_key"],
  "players": ["player_1", "player_2"],
  "visited": true
}
```

### Game State

```json
{
  "player_id": "player_1",
  "current_room": "room_id_xyz",
  "inventory": ["torch"],
  "quest_summary": "You are seeking the lost crown of Azalon...",
  "memory_log": ["Entered cave", "Spoke to guardian"],
  "world_graph": [ ... ]
}
```

### NPC Memory (Example Structure)

```json
{
  "npc_id": "old_guardian",
  "name": "Old Guardian",
  "location": "room_id_xyz",
  "dialogue_embedding_index": "pinecone://npc_memories/old_guardian",
  "last_interaction": "2025-06-28T10:32:00Z",
  "interaction_log": ["Greeted player_1", "Refused entry to the cave"]
}
```

---

## üîß LLM Prompt Template

```plaintext
SYSTEM:
You are the game master of a fantasy MUD. The player explores the world, talks to NPCs, and solves a main quest. Keep story tone consistent. Use the player‚Äôs past log and current room to stay grounded.

INCLUDE:
- Summary of current location
- Inventory
- Current quest goal
- What just happened
- Players currently in room (optional dialogue-style commentary)
- NPCs available for interaction and their latest known behavior and memory

USER:
"open the door to the east"
```

---

## üö´ Limitations to Avoid

- Do not break fourth wall
- Do not add random genre shifts
- Do not forget existing rooms, NPCs, inventory, or other players in the room
- Do not reintroduce already solved plot points
- Keep NPC dialogue and behavior consistent
- NPCs should not contradict previous memory unless deliberately scripted
